<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TSS Tracker - Upload</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:0; }
        main { max-width:600px; margin:3rem auto; padding:2rem; background:white; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
        header nav a { color:white; margin:0 1rem; text-decoration:none; font-weight:bold; }
        header, footer { background:#1e40af; color:white; padding:1rem; text-align:center; }
        h2 { color:#1e40af; text-align:center; }
        form { display:flex; flex-direction:column; margin-bottom:1.5rem; }
        input { margin:0.5rem 0; padding:0.5rem; border:1px solid #ccc; border-radius:4px; }
        button { padding:0.5rem; background:#1e40af; color:white; border:none; border-radius:4px; cursor:pointer; }
        button:hover { background:#374ac0; }
        #result { margin-top:1rem; color:green; font-weight:bold; }
    </style>
    <script src="./js/main.js"></script>
</head>
<body>
<main>
    <h2>Calculate Zones</h2>

    <form id="rollingUploadForm">
        <input type="file" name="rollingfile" accept=".tcx" required>
        <button type="submit">Upload Rolling File</button>
    </form>

    <div id="result"></div>
</main>

<script>
const token = localStorage.getItem('token');
if (!token) {
    // Redirect to login if not logged in
    window.location.href = '/login.html';
}

const form2 = document.getElementById('rollingUploadForm');
const resultDiv = document.getElementById('result');

async function uploadFile(file, onUpload) {
    const formData = new FormData();
    formData.append('tcxfile', file);
    formData.append('onUpload', onUpload);

    try {
        const res = await fetch('/upload', {
            method: 'POST',
            headers: { 'Authorization': 'Bearer ' + token },
            body: formData
        });

        if (!res.ok) {
            const text = await res.text();
            throw new Error(text || 'Upload failed');
        }

        const data = await res.json();
        resultDiv.innerHTML = `File queued! Job ID: ${data.jobId}`;
    } catch (err) {
        resultDiv.innerHTML = `Error: ${err.message}`;
        resultDiv.style.color = 'red';
    }
}

form2.addEventListener('submit', e => {
    e.preventDefault();
    const fileInput = form2.querySelector('input[name="rollingfile"]');
    uploadFile(fileInput.files[0], 'rolling');
});
</script>
</body>
</html>
